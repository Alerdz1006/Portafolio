<!DOCTYPE html>
<html lang="es-MX">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Punto de venta</title>

    <style>
        
    </style>
    </head>
<body>

    <div class="container">
        <h1>Punto de Venta</h1>

        <form id="form-producto" class="form-container">
            <div class="form-group">
                <label for="producto">Producto:</label>
                <select id="producto">
                </select>
            </div>
            
            <div class="form-group">
                <label for="precio">Precio:</label>
                <input type="text" id="precio" readonly>
            </div>

            <div class="form-group">
                <label for="unidades">Unidades:</label>
                <input type="number" id="unidades" placeholder="Ingrese la cantidad" min="1" value="1">
            </div>

            <button type="submit" id="btn-agregar">Agregar</button>
        </form>
        <table id="tabla-ventas">
            <thead>
                <tr>
                    <th>Número</th>
                    <th>Producto</th>
                    <th>Precio Unitario</th>
                    <th>Unidades</th>
                    <th>Monto</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="tabla-body">
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="4" class="total-label">Subtotal:</td>
                    <td id="subtotal-valor">0.00</td>
                    <td></td> </tr>
                <tr>
                    <td colspan="4" class="total-label">Iva (16%):</td>
                    <td id="iva-valor">0.00</td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan="4" class="total-label total-final">Total:</td>
                    <td id="total-valor" class="total-final">0.00</td>
                    <td></td>
                </tr>
            </tfoot>
        </table>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {

            const productos = {
                "Lapiz": 7.5,
                "Borrador": 6.4,
                "Sacapuntas": 5.5,
                "Pluma Azul": 10.0,
                "Juego Geométrico": 35.0,
                "Cuaderno Profesional": 42.0,
                "Quien sabe undostres": 22.0,
                "pruebas": 421.0
            };
            
            const form = document.getElementById('form-producto');
            const productoSelect = document.getElementById('producto');
            const precioInput = document.getElementById('precio');
            const unidadesInput = document.getElementById('unidades');
            const tablaBody = document.getElementById('tabla-body');
            
            const subtotalEl = document.getElementById('subtotal-valor');
            const ivaEl = document.getElementById('iva-valor');
            const totalEl = document.getElementById('total-valor');

            function cargarProductos() {
                productoSelect.innerHTML = '<option value="">-- Seleccione --</option>';
                for (const nombre in productos) {
                    const precio = productos[nombre];
                    const option = document.createElement('option');
                    option.value = precio; 
                    option.textContent = nombre; 
                    productoSelect.appendChild(option);
                }
            }

            productoSelect.addEventListener('change', function() {
                const precio = productoSelect.value;
                if (precio) {
                    precioInput.value = parseFloat(precio).toFixed(2);
                } else {
                    precioInput.value = ''; 
                }
            });

            form.addEventListener('submit', function(e) {
                e.preventDefault(); 

                const productoNombre = productoSelect.options[productoSelect.selectedIndex].text;
                const precioUnit = parseFloat(precioInput.value);
                const unidades = parseInt(unidadesInput.value);

                if (productoNombre === "-- Seleccione --" || !unidades || unidades <= 0) {
                    alert('Por favor, selecciona un producto y pon una cantidad válida.');
                    return;
                }

                const monto = precioUnit * unidades;
                const numeroFila = tablaBody.rows.length + 1;

                const nuevaFila = `
                    <tr>
                        <td>${numeroFila}</td>
                        <td data-nombre="${productoNombre}">${productoNombre}</td>
                        <td>${precioUnit.toFixed(2)}</td>
                        <td>${unidades}</td>
                        <td class="monto-celda">${monto.toFixed(2)}</td>
                        <td>
                            <button class="btn btn-modificar">Modificar</button>
                            <button class="btn btn-eliminar">Eliminar</button>
                        </td>
                    </tr>
                `;

                tablaBody.insertAdjacentHTML('beforeend', nuevaFila);

                actu_total();
                
                form.reset();
                precioInput.value = '';
            });

            tablaBody.addEventListener('click', function(e) {
                const fila = e.target.closest('tr');
                if (!fila) return; 

                if (e.target.classList.contains('btn-eliminar')) {
                    if (confirm('¿Al chile quieres borrar este producto?')) {
                        fila.remove();
                        actu_total();
                        actu_num_fila(); 
                    }
                }

                if (e.target.classList.contains('btn-modificar')) {
                    const boton = e.target;
                    
                    const celdaUnidades = fila.children[3];
                    
                    celdaUnidades.setAttribute('data-original', celdaUnidades.textContent);
                    
                    boton.textContent = 'Guardar';
                    boton.classList.remove('btn-modificar');
                    boton.classList.add('btn-guardar');
                    
                    fila.classList.add('fila-editando');
                    celdaUnidades.setAttribute('contenteditable', 'true');
                    
                    const range = document.createRange();
                    range.selectNodeContents(celdaUnidades);
                    const sel = window.getSelection();
                    sel.removeAllRanges();
                    sel.addRange(range);
                } 
                else if (e.target.classList.contains('btn-guardar')) {
                    const boton = e.target;
                    const celdaUnidades = fila.children[3];
                    
                    celdaUnidades.setAttribute('contenteditable', 'false');
                    fila.classList.remove('fila-editando');
                    
                    boton.textContent = 'Modificar';
                    boton.classList.remove('btn-guardar');
                    boton.classList.add('btn-modificar');

                    let mas_unidades = parseInt(celdaUnidades.textContent);
                    if (isNaN(mas_unidades) || mas_unidades <= 0) {
                        alert('Valor no válido. Revirtiendo...');
                        celdaUnidades.textContent = celdaUnidades.getAttribute('data-original');
                    } else {
                        const precioUnit = parseFloat(fila.children[2].textContent);
                        const nuevoMonto = precioUnit * mas_unidades;
                        
                        fila.children[3].textContent = mas_unidades; 
                        fila.children[4].textContent = nuevoMonto.toFixed(2); 
                    }
                    
                    actu_total();
                }
            });

            function actu_total() {
                let subtotal = 0;
                const todasLasFilas = tablaBody.querySelectorAll('tr');

                todasLasFilas.forEach(fila => {
                    const montoCelda = fila.querySelector('.monto-celda');
                    if(montoCelda) {
                        subtotal += parseFloat(montoCelda.textContent);
                    }
                });

                const iva = subtotal * 0.16; 
                const total = subtotal + iva;

                subtotalEl.textContent = subtotal.toFixed(2);
                ivaEl.textContent = iva.toFixed(2);
                totalEl.textContent = total.toFixed(2);
            }
            
            function actu_num_fila() {
                const todasLasFilas = tablaBody.querySelectorAll('tr');
                todasLasFilas.forEach((fila, index) => {
                    fila.children[0].textContent = index + 1; 
                });
            }

            cargarProductos(); 

        });
    </script>
    </body>
</html>
